<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Dosis Diaria de Inspiración</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Merriweather:ital,wght@0,300;0,400;0,700;1,300&family=Montserrat:wght@300;400;600&display=swap');

        body {
            font-family: 'Montserrat', sans-serif;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            min-height: 100vh;
            /* Evita el rebote de scroll en iOS */
            overscroll-behavior-y: none;
        }
        
        .quote-font {
            font-family: 'Merriweather', serif;
        }

        .fade-in {
            animation: fadeIn 1.0s ease-out;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Optimizaciones para toque en móviles */
        .feedback-btn {
            transition: transform 0.1s active, background-color 0.2s;
            touch-action: manipulation; /* Elimina el delay de 300ms */
            -webkit-tap-highlight-color: transparent; /* Elimina el flash gris */
        }
        .feedback-btn:active {
            transform: scale(0.96);
        }
    </style>
</head>
<body class="flex items-center justify-center min-h-screen px-4 py-6">

    <div class="bg-white/95 backdrop-blur-sm rounded-3xl shadow-xl w-full max-w-lg border border-white/60 flex flex-col overflow-hidden relative">
        
        <!-- Contenido Principal -->
        <div class="p-6 md:p-10 flex flex-col items-center text-center flex-grow">
            
            <!-- Logo de la Universidad -->
            <div class="mb-5 w-full flex justify-center">
                <img src="OIP.webp" 
                     alt="Universidad Politécnica Salesiana" 
                     class="h-24 md:h-28 w-auto object-contain hover:scale-105 transition-transform duration-300">
            </div>

            <!-- Contenedor de la frase -->
            <div id="quote-container" class="mb-8 w-full fade-in flex-grow flex flex-col justify-center">
                <p id="quote-text" class="quote-font text-xl md:text-3xl text-gray-800 italic leading-relaxed mb-4">
                    "Cargando inspiración..."
                </p>
                <p id="quote-author" class="text-xs md:text-sm text-gray-500 uppercase tracking-widest font-bold mt-2">
                    
                </p>
            </div>

            <!-- SECCIÓN DE FEEDBACK -->
            <div id="feedback-section" class="w-full bg-indigo-50/80 rounded-2xl p-5 border border-indigo-100">
                <p id="feedback-question" class="text-sm text-gray-600 mb-4 font-semibold">¿Te ayudó esta frase?</p>
                
                <div id="feedback-buttons" class="flex gap-3 w-full">
                    <!-- Botones expandidos para fácil acceso táctil -->
                    <button onclick="registrarRespuesta('SI')" class="feedback-btn flex-1 flex items-center justify-center gap-2 py-4 bg-white text-green-600 border border-green-200 rounded-xl shadow-sm hover:bg-green-50 font-bold text-base md:text-lg">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 md:h-6 md:w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M5 13l4 4L19 7" />
                        </svg>
                        SÍ
                    </button>
                    
                    <button onclick="registrarRespuesta('NO')" class="feedback-btn flex-1 flex items-center justify-center gap-2 py-4 bg-white text-red-500 border border-red-200 rounded-xl shadow-sm hover:bg-red-50 font-bold text-base md:text-lg">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 md:h-6 md:w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M6 18L18 6M6 6l12 12" />
                        </svg>
                        NO
                    </button>
                </div>
                
                <!-- Mensajes de estado -->
                <div id="feedback-message" class="hidden py-2 text-indigo-600 text-sm font-semibold animate-pulse">
                    ¡Gracias! Tu respuesta se ha guardado.
                </div>
                <div id="feedback-error" class="hidden py-2 text-red-500 text-xs mt-2">
                    Hubo un error al guardar.
                </div>
            </div>
        </div>

        <!-- Pie de tarjeta -->
        <div class="bg-gray-50 px-6 py-3 text-center border-t border-gray-100">
             <div class="text-[10px] md:text-xs text-gray-400 font-medium">
                Frases vistas: <span id="counter">0</span> / <span id="total">0</span>
            </div>
        </div>
    </div>

    <script>
        // --- CONFIGURACIÓN ---
        // ¡IMPORTANTE! Pega aquí la URL de tu Google Apps Script
        const GOOGLE_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbyASPejs8TkTMFFl8M_g96swjUvS4PaJpAV_K7oWYgAc5sASz23V2X86EEiPgrxzIV5/exec'; 

        // --- BASE DE DATOS DE FRASES ---
        const frasesDatabase = [
            { text: "El único modo de hacer un gran trabajo es amar lo que haces.", author: "Steve Jobs" },
            { text: "No cuentes los días, haz que los días cuenten.", author: "Muhammad Ali" },
            { text: "La felicidad no es algo que pospones para el futuro; es algo que diseñas para el presente.", author: "Jim Rohn" },
            { text: "Cree que puedes y casi lo habrás logrado.", author: "Theodore Roosevelt" },
            { text: "Lo que no te mata te hace más fuerte.", author: "Friedrich Nietzsche" },
            { text: "La vida es 10% lo que te ocurre y 90% cómo reaccionas a ello.", author: "Charles R. Swindoll" },
            { text: "No busques el momento perfecto, solo busca el momento y hazlo perfecto.", author: "Anónimo" },
            { text: "El éxito es la suma de pequeños esfuerzos repetidos día tras día.", author: "Robert Collier" },
            { text: "Tu tiempo es limitado, así que no lo desperdicies viviendo la vida de alguien más.", author: "Steve Jobs" },
            { text: "La mejor venganza es un éxito masivo.", author: "Frank Sinatra" },
            { text: "No te compares con nadie en este mundo. Si lo haces, te estás insultando a ti mismo.", author: "Bill Gates" },
            { text: "Si puedes soñarlo, puedes hacerlo.", author: "Walt Disney" },
            { text: "A veces la adversidad es lo que necesitas encarar para ser exitoso.", author: "Zig Ziglar" },
            { text: "La disciplina es el puente entre metas y logros.", author: "Jim Rohn" },
            { text: "El fracaso es solo la oportunidad de comenzar de nuevo de forma más inteligente.", author: "Henry Ford" }
        ];

        let fraseActual = null;

        // --- LÓGICA DE ALMACENAMIENTO LOCAL ---
        const STORAGE_KEY = 'frases_vistas_indices';
        
        function obtenerIndicesVistos() {
            const guardado = localStorage.getItem(STORAGE_KEY);
            return guardado ? JSON.parse(guardado) : [];
        }

        function guardarIndiceVisto(index) {
            const vistos = obtenerIndicesVistos();
            if (!vistos.includes(index)) {
                vistos.push(index);
                localStorage.setItem(STORAGE_KEY, JSON.stringify(vistos));
            }
            actualizarContador(vistos.length);
        }

        function reiniciarCiclo() {
            localStorage.removeItem(STORAGE_KEY);
            return [];
        }

        function actualizarContador(vistosCount) {
            document.getElementById('counter').innerText = vistosCount;
            document.getElementById('total').innerText = frasesDatabase.length;
        }

        function obtenerFraseAleatoria() {
            let vistos = obtenerIndicesVistos();
            const todosLosIndices = frasesDatabase.map((_, i) => i);
            let disponibles = todosLosIndices.filter(index => !vistos.includes(index));

            if (disponibles.length === 0) {
                vistos = reiniciarCiclo();
                disponibles = todosLosIndices;
            }

            const indiceAleatorio = disponibles[Math.floor(Math.random() * disponibles.length)];
            return { frase: frasesDatabase[indiceAleatorio], index: indiceAleatorio };
        }

        // --- LÓGICA DE RESPUESTA ---

        function registrarRespuesta(respuesta) {
            // UI: Ocultar botones, mostrar carga
            document.getElementById('feedback-buttons').classList.add('hidden');
            const messageEl = document.getElementById('feedback-message');
            const errorEl = document.getElementById('feedback-error');
            messageEl.classList.remove('hidden');
            messageEl.innerText = "Guardando...";
            
            const datosAEnviar = {
                respuesta: respuesta,
                frase: fraseActual ? fraseActual.text : "Desconocida"
            };

            if (GOOGLE_SCRIPT_URL === 'TU_URL_DE_APPS_SCRIPT_AQUI') {
                console.warn("Falta configurar la URL de Google Apps Script");
                setTimeout(() => {
                    messageEl.innerText = "Guardado (Modo Demo Local).";
                }, 500);
                return;
            }

            fetch(GOOGLE_SCRIPT_URL, {
                method: "POST",
                mode: "no-cors", 
                headers: { "Content-Type": "text/plain" },
                body: JSON.stringify(datosAEnviar)
            })
            .then(() => {
                if (respuesta === 'SI') {
                    messageEl.innerText = "¡Genial! Nos alegra ayudar.";
                } else {
                    messageEl.innerText = "Gracias por tu opinión.";
                }
            })
            .catch(error => {
                console.error("Error:", error);
                messageEl.classList.add('hidden');
                errorEl.classList.remove('hidden');
                errorEl.innerText = "Error de conexión.";
            });
        }

        function mostrarNuevaFrase() {
            document.getElementById('feedback-buttons').classList.remove('hidden');
            document.getElementById('feedback-message').classList.add('hidden');
            document.getElementById('feedback-error').classList.add('hidden');

            const container = document.getElementById('quote-container');
            const quoteText = document.getElementById('quote-text');
            const quoteAuthor = document.getElementById('quote-author');

            container.classList.remove('fade-in');
            void container.offsetWidth; 
            container.classList.add('fade-in');

            const resultado = obtenerFraseAleatoria();
            fraseActual = resultado.frase; 
            
            quoteText.innerText = `"${resultado.frase.text}"`;
            quoteAuthor.innerText = `- ${resultado.frase.author || 'Anónimo'}`;

            guardarIndiceVisto(resultado.index);
        }

        window.onload = () => {
            mostrarNuevaFrase();
            actualizarContador(obtenerIndicesVistos().length);
        };

    </script>
</body>
</html>
